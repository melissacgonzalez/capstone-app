<!-- LISTINGS DETAILS TITLE SECTION -->
<section class="clearfix paddingAdjustBottom">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <div class="listingTitleArea">
          <h2><%= @event.name.split("- ")[0] %></h2>
          <p><%= @event.datetime.strftime("%A, %B %e, %Y at %l:%M %P") %></p>
          <p><span class="placeName"><%= @event.location.name %></span>
          <%= @event.location.street_address %>, <%= @event.location.city %>, <%= @event.location.state %> <%= @event.location.zip %></p>
          
          <div class="listingReview">
            <ul class="list-inline rating">
              <% @event.overall_rating.to_i.times do %>
                <li><i class="fa fa-star" aria-hidden="true"></i></li>
              <% end %>
              <% (5 - @event.overall_rating.to_i).times do %>
                <li><i class="fa fa-star-o" aria-hidden="true"></i></li>
              <% end %>
            </ul>
            <span>( <%= @reports.count %> Reports )</span>
            <% if current_user.report_for(@event) %>
              <a href="/reports/<%= current_user.report_for(@event).id %>/edit" class="btn btn-primary">Edit Report</a>
            <% elsif current_user.registration_for(@event) %>
              <a href="/reports/new?reg_id=<%= @event.registrations.find_by(user_id: current_user.id).id %>" class="btn btn-primary">Write a Report</a>
            <% end %>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<!-- LISTINGS DETAILS IMAGE SECTION -->
<section class="clearfix paddingAdjustTopBottom">
  <ul class="list-inline listingImage">
    <li><img src="<%= @event.main_image %>" alt="Image Listing" class="img-responsive"></li>
    <li><img src="<%= @event.image2 %>" alt="Image Listing" class="img-responsive"></li>
    <li><img src="<%= @event.image3 %>" alt="Image Listing" class="img-responsive"></li>
    <li><img src="<%= @event.image4 %>" alt="Image Listing" class="img-responsive"></li>
  </ul>
</section>

<!-- LISTINGS DETAILS INFO SECTION -->
<section class="clearfix paddingAdjustTop">
  <div class="container">
    <div class="row">
      <div class="col-sm-8 col-xs-12">
        <div class="listDetailsInfo">
          <div class="detailsInfoBox">
            <h3></h3>
            <h3><%= @event.sport ? @event.distance + " " + @event.sport.name : "About This Event" %></h3>    
            <p><%= @event.description %></p> 



            <% if @event.reports != [] %>
              <div class="detailsInfoBox">
                <h3>Race Reports</h3>
                <% @reports.each do |report| %>
                  <div class="media media-comment">
                    <div class="media-left">
                    <img src="<%= report.user.avatar %>" class="media-object img-circle" alt="Image User">
                    </div>
                    <div class="media-body">
                      <h3 class="media-heading"><a href="/users/<%= report.user.id %>"><%= report.user.first_name %> <%= report.user.last_name %></a></h3>
                      <ul class="list-inline rating">
                        <% report.overall_rating.times do %>
                          <li><i class="fa fa-star" aria-hidden="true"></i></li>
                        <% end %>
                        <% (5 - report.overall_rating).times do %>
                          <li><i class="fa fa-star-o" aria-hidden="true"></i></li>
                        <% end %>
                        <%= report.overall_rating %> Star<% if report.overall_rating > 1 %>s<% end %>
                      </ul>
                      <h3 class="media-heading"><a href="/reports/<%= report.id %>"><%= report.title %></a></h3>
                      <p><%= report.body %> </p>
                      <p><a href="/reports/<%= report.id %>">Read More...</a></p>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>





          </div>
        </div>
      </div>
      <div class="col-sm-4 col-xs-12">
        <div class="clearfix map-sidebar map-right">
          <div id="map" style="position:relative; margin: 0;padding: 0;height: 538px; max-width: none;"></div>
        </div>
        <div class="listSidebar">
          <% if current_user %>         
            <% if @event.datetime > Time.now %>
              <h3>RSVP</h3>
                <% if current_user.registrations.find_by(event_id: @event.id) %>
                  <%= form_tag "/registrations/#{current_user.registrations.find_by(event_id: @event.id).id}", method: :patch do %>
                    <button type="submit" name="status" value="Registered" class="btn btn-primary btn-block">I'm Racing</button>
                      <p></p>
                      <button type="submit" name="status" value="Volunteering" class="btn btn-secondary btn-block">I'm Volunteering</button>
                      <p></p>
                    <button type="submit" name="status" value="Cancelled" class="btn btn-secondary btn-block">Not Going</button>
                  <% end %>
                <% else %>
                  <%= form_tag "/registrations", method: :post do %>
                    <input type="hidden" name="event_id" value="<%= @event.id %>">
                    
                    <% if @event.event_type == "Race" %>
                      <button type="submit" name="status" value="Registered" class="btn btn-primary btn-block">I'm Racing</button>
                      <p></p>
                      <button type="submit" name="status" value="Volunteering" class="btn btn-secondary btn-block">I'm Volunteering</button>
                      <p></p> 
                    <% else %>
                      <button type="submit" name="status" value="Attending" class="btn btn-primary btn-block">I'm Attending</button>
                      <p></p>
                      <button type="submit" name="status" value="Interested" class="btn btn-secondary btn-block">I'm Interested</button>
                    <% end %>              
                  <% end %>
                <% end %>
              <br>
              <h3>Who's Going?</h3>
            <% else %>
              <h3>Average Rating: <%= @event.overall_rating %> Stars</h3>
              <h3>Who Went?</h3>
            <% end %>
            <ul class="list-unstyled sidebarList">
              <% @registrants.each do |registrant| %>
                <li><a href="/users/<%= registrant.id %>"><%= registrant.first_name %> <%= registrant.last_name %></a>
                <% if registrant.registration_status(@event.id) != "Registered" %>(<%= registrant.registration_status(@event.id) %>)<% end %></li>
              <% end %>
            </ul>
          <% else %>
            <h3>Login to RSVP!</h3>
            <%= form_tag "/login", method: :post do %>
              <div class="form-group">
                <i class="fa fa-envelope" aria-hidden="true"></i>
                <input type="email" class="form-control" id="email" placeholder="Email" name="email">
              </div>
              <div class="form-group">
                <i class="fa fa-lock" aria-hidden="true"></i>
                <input type="password" class="form-control" id="pwd" placeholder="Password" name="password">
              </div>
              <div class="form-group">
                <input type="submit" class="btn btn-primary btn-block" value="Log In">
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</section>


